<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SocialUp â€“ socialinÄ—s veiklos</title>
<link rel="stylesheet" href="style.css">
</head>

<body>
<div class="container">

<!-- LOGIN -->
<div id="loginSection">
  <h1>Prisijungimas</h1>
  <input id="loginInput" placeholder="Vardas arba ORG-123">
  <button onclick="login()">Prisijungti</button>
</div>

<!-- VEIKLOS -->
<div id="activitiesSection" style="display:none;">
  <h1>SocialinÄ—s veiklos</h1>

  <!-- ORGANIZACIJA -->
  <div id="orgPanel" style="display:none;">
    <h2>PridÄ—ti veiklÄ…</h2>
    <input id="title" placeholder="Veiklos pavadinimas">
    <input id="date" type="date">
    <input id="dateFrom" type="date">
    <input id="dateTo" type="date">
    <input id="timeFrom" type="time">
    <input id="timeTo" type="time">
    <input id="age" type="number" min="1" placeholder="Nuo keliÅ³ metÅ³">
    <textarea id="description" placeholder="Veiklos apraÅ¡ymas"></textarea>
    <input id="locationInput" placeholder="Vietos nuoroda (Google Maps)">
    <button id="saveBtn" onclick="saveActivity()">IÅ¡saugoti veiklÄ…</button>
  </div>

  <div class="activities" id="activitiesContainer"></div>
  <button class="logout" onclick="logout()">Atsijungti</button>
</div>

<!-- APIE MANE (GRÄ„Å½INTA) -->
<div class="about-me">
  <img src="apie-mane.jpg" alt="AÅ¡ savanoriaujant">
  <div>
    <h2>Apie mane</h2>
    <p><b>Sveiki, aÅ¡ esu Benediktas.</b></p>
    <p>
      Tai mano mokyklos projektas, kurÄ¯ noriu paversti realiu socialiniu projektu.
      Projekto tikslas â€“ skatinti jaunimÄ… Ä¯sitraukti Ä¯ socialines veiklas ir
      palengvinti bendradarbiavimÄ… tarp organizacijÅ³ ir savanoriÅ³.
    </p>
  </div>
</div>

</div>

<script>
/* ===== BENDRA ===== */
function getOrgs(){
  return JSON.parse(localStorage.getItem("orgs")) || {};
}
function saveOrgs(orgs){
  localStorage.setItem("orgs", JSON.stringify(orgs));
}

/* ===== LOGIN ===== */
function login(){
  const val = loginInput.value.trim();
  if(!val) return alert("Ä®vesk vardÄ… arba ORG kodÄ…");

  const orgs = getOrgs();

  if(val.startsWith("ORG-")){
    if(!orgs[val]){
      const name = prompt("Organizacijos pavadinimas:");
      if(!name) return;
      orgs[val] = { name, activities: [] };
      saveOrgs(orgs);
    }
    localStorage.setItem("role","org");
    localStorage.setItem("orgCode",val);
  } else {
    localStorage.setItem("role","user");
    localStorage.setItem("user",val);
  }
  location.reload();
}

function logout(){
  localStorage.removeItem("role");
  localStorage.removeItem("user");
  localStorage.removeItem("orgCode");
  location.reload();
}

/* ===== VEIKLOS ===== */
let editId = null;

function saveActivity(){
  const orgCode = localStorage.getItem("orgCode");
  const orgs = getOrgs();
  const org = orgs[orgCode];

  const activity = {
    title: title.value.trim(),
    date: date.value,
    dateFrom: dateFrom.value,
    dateTo: dateTo.value,
    timeFrom: timeFrom.value,
    timeTo: timeTo.value,
    age: Number(age.value),
    description: description.value.trim(),
    location: locationInput.value.trim()
  };

  if(Object.values(activity).some(v => !v)){
    return alert("UÅ¾pildyk visus laukus");
  }

  if(editId){
    Object.assign(org.activities.find(a => a.id === editId), activity);
    editId = null;
    saveBtn.textContent = "IÅ¡saugoti veiklÄ…";
  } else {
    org.activities.push({
      id: Date.now(),
      ...activity,
      registered: []   // {name, day, time}
    });
  }

  saveOrgs(orgs);
  document.querySelectorAll("#orgPanel input, #orgPanel textarea").forEach(e => e.value="");
  renderActivities();
}

/* ===== REGISTRACIJA SU DATA + LAIKU ===== */
function toggleRegister(orgCode, id){
  const user = localStorage.getItem("user");
  if(!user) return;

  const orgs = getOrgs();
  const activity = orgs[orgCode].activities.find(a => a.id === id);

  const existing = activity.registered.find(r => r.name === user);

  if(existing){
    activity.registered = activity.registered.filter(r => r.name !== user);
  } else {
    const day = prompt("KuriÄ… dienÄ… ateisi? (YYYY-MM-DD)");
    if(!day) return;
    const time = prompt("KuriÄ… valandÄ… ateisi? (HH:MM)");
    if(!time) return;

    activity.registered.push({ name: user, day, time });
  }

  saveOrgs(orgs);
  renderActivities();
}

/* ===== RENDER ===== */
function renderActivities(){
  activitiesContainer.innerHTML = "";
  const role = localStorage.getItem("role");
  const orgs = getOrgs();
  const user = localStorage.getItem("user");
  const curOrg = localStorage.getItem("orgCode");

  orgPanel.style.display = role === "org" ? "block" : "none";

  Object.entries(orgs).forEach(([code, org])=>{
    org.activities.forEach(a=>{
      const isReg = user && a.registered.some(r => r.name === user);

      activitiesContainer.innerHTML += `
      <div class="card">
        <h3>${a.title}</h3>
        <p><b>ğŸ¢ ${org.name}</b></p>
        <p>ğŸ“… ${a.date}</p>
        <p>ğŸ“† ${a.dateFrom} â€“ ${a.dateTo}</p>
        <p>â° ${a.timeFrom} â€“ ${a.timeTo}</p>
        <p>ğŸ‚ Nuo ${a.age} m.</p>
        <p>ğŸ“ ${a.description}</p>
        <p>ğŸ‘¥ UÅ¾siregistravÄ™: ${a.registered.length}</p>

        ${role==="org" && code===curOrg && a.registered.length
          ? `<p>ğŸ“‹ Dalyviai:<br>
             ${a.registered.map(r => `ğŸ‘¤ ${r.name} â€“ ${r.day} ${r.time}`).join("<br>")}
             </p>` : ""}

        ${a.location ? `<a href="${a.location}" target="_blank">ğŸ“ Vieta</a>` : ""}

        ${role==="user"
          ? `<button class="register-btn" onclick="toggleRegister('${code}',${a.id})">
              ${isReg ? "âŒ Atsiregistruoti" : "âœ… UÅ¾siregistruoti"}
            </button>` : ""}
      </div>`;
    });
  });
}

/* ===== START ===== */
document.addEventListener("DOMContentLoaded",()=>{
  if(localStorage.getItem("role")){
    loginSection.style.display = "none";
    activitiesSection.style.display = "block";
    renderActivities();
  }
});
</script>

</body>
</html>
