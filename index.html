<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SocialUp â€“ socialinÄ—s veiklos</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

  <!-- LOGIN -->
  <div id="loginSection">
    <h1>Prisijungimas</h1>
    <input id="loginInput" placeholder="Vardas arba ORG-123">
    <button onclick="login()">Prisijungti</button>
  </div>

  <!-- VEIKLOS -->
  <div id="activitiesSection" style="display:none;">
    <h1>SocialinÄ—s veiklos</h1>

    <!-- ORGANIZACIJAI -->
    <div id="orgPanel" style="display:none;">
      <h2>PridÄ—ti veiklÄ…</h2>
      <input id="title" placeholder="Veiklos pavadinimas">
      <input id="date" type="date">
      <input id="timeFrom" type="time" placeholder="Nuo">
      <input id="timeTo" type="time" placeholder="Iki">
      <input id="age" type="number" min="1" placeholder="Nuo keliÅ³ metÅ³">
      <textarea id="description" placeholder="Veiklos apraÅ¡ymas"></textarea>
      <input id="locationInput" placeholder="Vietos nuoroda (Google Maps)">
      <button onclick="addActivity()">IÅ¡saugoti veiklÄ…</button>
    </div>

    <div class="activities" id="activitiesContainer"></div>
    <button class="logout" onclick="logout()">Atsijungti</button>
  </div>

  <!-- APIE MANE -->
  <div class="about-me">
    <img src="apie-mane.jpg" alt="AÅ¡ savanoriaujant">
    <div>
      <h2>Apie mane</h2>
      <p><b>Sveiki, aÅ¡ esu Benediktas.</b></p>
      <p>Tai mano mokyklos projektas, kurÄ¯ noriu paversti realiu socialiniu projektu.  
      Projekto tikslas â€“ skatinti socialinÄ™ veiklÄ… tarp jaunimo ir organizacijÅ³ bendradarbiavimÄ…, suteikti galimybÄ™ dalyvauti Ä¯vairiose veiklose, registruotis ir sekti savo dalyvavimÄ….</p>
    </div>
  </div>

</div>

<script>
// -------- LOGIN --------
function login(){
  const val = document.getElementById("loginInput").value.trim();
  if(!val) return alert("Ä®vesk vardÄ… arba ORG kodÄ…");

  let orgs = JSON.parse(localStorage.getItem("orgs")) || {};

  if(val.startsWith("ORG-")){
    if(!orgs[val]){
      const name = prompt("Organizacijos pavadinimas:");
      if(!name) return;
      orgs[val] = { name: name, activities: [] };
      localStorage.setItem("orgs", JSON.stringify(orgs));
    }
    localStorage.setItem("role","org");
    localStorage.setItem("orgCode",val);
  } else {
    localStorage.setItem("role","user");
    localStorage.setItem("user",val);
  }

  location.reload();
}

function logout(){
  localStorage.removeItem("role");
  localStorage.removeItem("user");
  localStorage.removeItem("orgCode");
  location.reload();
}

// -------- DUOMENYS --------
function getOrgs(){ return JSON.parse(localStorage.getItem("orgs")) || {}; }
function saveOrgs(orgs){ localStorage.setItem("orgs", JSON.stringify(orgs)); }

// -------- VEIKLOS --------
function addActivity(editId = null){
  const orgCode = localStorage.getItem("orgCode");
  if(!orgCode) return;

  const orgs = getOrgs();
  const org = orgs[orgCode];

  const title = document.getElementById("title").value.trim();
  const date = document.getElementById("date").value;
  const timeFrom = document.getElementById("timeFrom").value;
  const timeTo = document.getElementById("timeTo").value;
  const age = document.getElementById("age").value;
  const description = document.getElementById("description").value.trim();
  const locationVal = document.getElementById("locationInput").value.trim();

  if(!title || !date || !timeFrom || !timeTo || !age || !description){
    return alert("UÅ¾pildyk visus laukus");
  }

  if(editId){ // redagavimas
    const activity = org.activities.find(a => a.id === editId);
    if(activity){
      activity.title = title;
      activity.date = date;
      activity.timeFrom = timeFrom;
      activity.timeTo = timeTo;
      activity.age = Number(age);
      activity.description = description;
      activity.location = locationVal;
    }
  } else { // nauja veikla
    org.activities.push({
      id: Date.now(),
      title,
      date,
      timeFrom,
      timeTo,
      age: Number(age),
      description,
      location: locationVal,
      registered: []
    });
  }

  saveOrgs(orgs);

  // iÅ¡valyti formÄ…
  document.getElementById("title").value = "";
  document.getElementById("date").value = "";
  document.getElementById("timeFrom").value = "";
  document.getElementById("timeTo").value = "";
  document.getElementById("age").value = "";
  document.getElementById("description").value = "";
  document.getElementById("locationInput").value = "";

  renderActivities();
}

// -------- REDAGAVIMAS --------
function editActivity(orgCode, activityId){
  const orgs = getOrgs();
  const activity = orgs[orgCode].activities.find(a => a.id === activityId);
  if(!activity) return;

  document.getElementById("title").value = activity.title;
  document.getElementById("date").value = activity.date;
  document.getElementById("timeFrom").value = activity.timeFrom;
  document.getElementById("timeTo").value = activity.timeTo;
  document.getElementById("age").value = activity.age;
  document.getElementById("description").value = activity.description;
  document.getElementById("locationInput").value = activity.location;

  const btn = document.querySelector("#orgPanel button");
  btn.textContent = "IÅ¡saugoti pakeitimus";
  btn.onclick = () => addActivity(activityId);
}

// -------- TRYNIMAS --------
function deleteActivity(orgCode, activityId){
  if(!confirm("Ar tikrai norite iÅ¡trinti Å¡iÄ… veiklÄ…?")) return;
  const orgs = getOrgs();
  orgs[orgCode].activities = orgs[orgCode].activities.filter(a => a.id !== activityId);
  saveOrgs(orgs);
  renderActivities();
}

// -------- REGISTRACIJA --------
function toggleRegister(orgCode, activityId){
  const user = localStorage.getItem("user");
  if(!user) return alert("Prisijunkite, kad galÄ—tumÄ—te registruotis");

  const orgs = getOrgs();
  const activity = orgs[orgCode].activities.find(a => a.id === activityId);

  if(activity.registered.includes(user)){
    activity.registered = activity.registered.filter(u => u !== user);
  } else {
    activity.registered.push(user);
  }

  saveOrgs(orgs);
  renderActivities();
}

// -------- RENDER --------
function renderActivities(){
  const role = localStorage.getItem("role");
  const activitiesContainer = document.getElementById("activitiesContainer");
  activitiesContainer.innerHTML = "";

  const orgPanel = document.getElementById("orgPanel");
  orgPanel.style.display = role === "org" ? "block" : "none";

  const orgs = getOrgs();
  const user = localStorage.getItem("user");
  const currentOrgCode = localStorage.getItem("orgCode");

  Object.entries(orgs).forEach(([orgCode, org]) => {
    org.activities.forEach(a => {
      const isRegistered = user && a.registered.includes(user);
      let timeStr = `â° ${a.timeFrom} â€“ ${a.timeTo}`;
      let regStatus = role==="user" ? (isRegistered ? "ğŸŸ¢ UÅ¾siregistravÄ™s" : "ğŸ”´ NeprisiregistravÄ™s") : "";

      let orgControls = "";
      if(role==="org" && orgCode===currentOrgCode){
        orgControls = `
          <button class="edit-btn" onclick="editActivity('${orgCode}',${a.id})">âœï¸ Redaguoti</button>
          <button class="delete-btn" onclick="deleteActivity('${orgCode}',${a.id})">ğŸ—‘ï¸ IÅ¡trinti</button>
        `;
      }

      activitiesContainer.innerHTML += `
        <div class="card">
          <h3>${a.title}</h3>
          <p><b>ğŸ¢ ${org.name}</b></p>
          <p>ğŸ“… ${a.date}</p>
          <p>${timeStr}</p>
          <p>ğŸ‚ Nuo ${a.age} m.</p>
          <p>ğŸ“ ${a.description}</p>
          <p>ğŸ‘¥ UÅ¾siregistravÄ™: ${a.registered.length}</p>
          ${a.location ? `<a href="${a.location}" target="_blank">ğŸ“ Vieta</a>` : ""}
          ${role==="user" ? `<p>${regStatus}</p><button class="register-btn" onclick="toggleRegister('${orgCode}', ${a.id})">${isRegistered ? "âŒ Atsiregistruoti" : "âœ… UÅ¾siregistruoti"}</button>` : ""}
          ${orgControls}
        </div>
      `;
    });
  });

  if(role==="org"){
    const btn = document.querySelector("#orgPanel button");
    btn.textContent = "IÅ¡saugoti veiklÄ…";
    btn.onclick = () => addActivity();
  }
}

// -------- START --------
window.addEventListener("DOMContentLoaded", () => {
  const role = localStorage.getItem("role");
  if(role){
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("activitiesSection").style.display = "block";
    renderActivities();
  }
});
</script>

</body>
</html>
