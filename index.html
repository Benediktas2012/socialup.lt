<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SocialUp</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

  <!-- LOGIN -->
  <div id="loginSection">
    <h1>Prisijungimas</h1>
    <input id="loginInput" placeholder="Vardas arba ORG-123">
    <button onclick="login()">Prisijungti</button>
  </div>

  <!-- VEIKLOS -->
  <div id="activitiesSection" style="display:none;">
    <h1>SocialinÄ—s veiklos</h1>

    <!-- ORGANIZACIJAI -->
    <div id="orgPanel" style="display:none;">
      <h2>PridÄ—ti / redaguoti veiklÄ…</h2>
      <input id="title" placeholder="Veiklos pavadinimas">
      <input id="dateFrom" type="date">
      <input id="dateTo" type="date">
      <input id="timeFrom" type="time">
      <input id="timeTo" type="time">
      <input id="age" type="number" placeholder="Nuo keliÅ³ metÅ³">
      <textarea id="description" placeholder="ApraÅ¡ymas"></textarea>
      <input id="locationInput" placeholder="Google Maps nuoroda">
      <button id="saveBtn">IÅ¡saugoti veiklÄ…</button>
    </div>

    <div class="activities" id="activitiesContainer"></div>
    <button class="logout" onclick="logout()">Atsijungti</button>
  </div>

  <!-- APIE MANE -->
  <div class="about-me">
    <img src="apie-mane.jpg">
    <div>
      <h2>Apie mane</h2>
      <p><b>Sveiki, aÅ¡ Benediktas.</b></p>
      <p>
        Tai mano mokyklos projektas, kurÄ¯ noriu paversti realiu socialiniu projektu.
        Tikslas â€“ skatinti jaunimo Ä¯sitraukimÄ… Ä¯ socialines veiklas ir padÄ—ti organizacijoms.
      </p>
    </div>
  </div>

</div>

<script>
let editId = null;

// LOGIN
function login(){
  const val = loginInput.value.trim();
  if(!val) return alert("Ä®vesk vardÄ… arba ORG kodÄ…");

  let orgs = JSON.parse(localStorage.getItem("orgs")) || {};

  if(val.startsWith("ORG-")){
    if(!orgs[val]){
      const name = prompt("Organizacijos pavadinimas:");
      if(!name) return;
      orgs[val] = { name, activities: [] };
      localStorage.setItem("orgs", JSON.stringify(orgs));
    }
    localStorage.setItem("role","org");
    localStorage.setItem("orgCode",val);
  } else {
    localStorage.setItem("role","user");
    localStorage.setItem("user",val);
  }
  location.reload();
}

function logout(){
  localStorage.clear();
  location.reload();
}

function getOrgs(){ return JSON.parse(localStorage.getItem("orgs")) || {}; }
function saveOrgs(o){ localStorage.setItem("orgs", JSON.stringify(o)); }

// SAVE
saveBtn.onclick = () => {
  const orgCode = localStorage.getItem("orgCode");
  const orgs = getOrgs();
  const org = orgs[orgCode];

  const activity = {
    id: editId || Date.now(),
    title: title.value,
    dateFrom: dateFrom.value,
    dateTo: dateTo.value,
    timeFrom: timeFrom.value,
    timeTo: timeTo.value,
    age: Number(age.value),
    description: description.value,
    location: locationInput.value,
    registered: editId ? org.activities.find(a=>a.id===editId).registered : []
  };

  if(!activity.title || !activity.dateFrom || !activity.dateTo) return alert("UÅ¾pildyk viskÄ…");

  if(editId){
    org.activities = org.activities.map(a=>a.id===editId?activity:a);
    editId = null;
    saveBtn.textContent = "IÅ¡saugoti veiklÄ…";
  } else {
    org.activities.push(activity);
  }

  saveOrgs(orgs);
  clearForm();
  render();
};

function clearForm(){
  title.value = dateFrom.value = dateTo.value = timeFrom.value = timeTo.value = age.value = description.value = locationInput.value = "";
}

// EDIT / DELETE
function editActivity(id){
  const org = getOrgs()[localStorage.getItem("orgCode")];
  const a = org.activities.find(a=>a.id===id);
  Object.assign(title, {value:a.title});
  dateFrom.value = a.dateFrom;
  dateTo.value = a.dateTo;
  timeFrom.value = a.timeFrom;
  timeTo.value = a.timeTo;
  age.value = a.age;
  description.value = a.description;
  locationInput.value = a.location;
  editId = id;
  saveBtn.textContent = "IÅ¡saugoti pakeitimus";
}

function deleteActivity(id){
  if(!confirm("IÅ¡trinti?")) return;
  const orgs = getOrgs();
  const org = orgs[localStorage.getItem("orgCode")];
  org.activities = org.activities.filter(a=>a.id!==id);
  saveOrgs(orgs);
  render();
}

// REGISTER
function register(orgCode, id){
  const user = localStorage.getItem("user");
  const day = prompt("KuriÄ… dienÄ… ateisi?");
  const time = prompt("KuriÄ… valandÄ…?");
  if(!day || !time) return;

  const orgs = getOrgs();
  const a = orgs[orgCode].activities.find(a=>a.id===id);
  a.registered.push({name:user, day, time});
  saveOrgs(orgs);
  render();
}

// RENDER
function render(){
  activitiesContainer.innerHTML="";
  const role = localStorage.getItem("role");
  orgPanel.style.display = role==="org"?"block":"none";

  Object.entries(getOrgs()).forEach(([code,org])=>{
    org.activities.forEach(a=>{
      activitiesContainer.innerHTML+=`
      <div class="card">
        <h3>${a.title}</h3>
        <p><b>ğŸ¢ ${org.name}</b></p>
        <p>ğŸ“† ${a.dateFrom} â€“ ${a.dateTo}</p>
        <p>â° ${a.timeFrom} â€“ ${a.timeTo}</p>
        <p>${a.description}</p>
        <p>ğŸ‘¥ ${a.registered.map(r=>`${r.name} (${r.day} ${r.time})`).join("<br>")}</p>
        ${role==="user"?`<button onclick="register('${code}',${a.id})">Registruotis</button>`:""}
        ${role==="org" && localStorage.getItem("orgCode")===code?
        `<button class="edit-btn" onclick="editActivity(${a.id})">âœï¸</button>
         <button class="delete-btn" onclick="deleteActivity(${a.id})">ğŸ—‘ï¸</button>`:""}
      </div>`;
    });
  });
}

if(localStorage.getItem("role")){
  loginSection.style.display="none";
  activitiesSection.style.display="block";
  render();
}
</script>

</body>
</html>
