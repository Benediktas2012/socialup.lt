<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SocialUp â€“ socialinÄ—s veiklos</title>
<link rel="stylesheet" href="style.css">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX');
</script>
</head>

<body>
<div class="container">

<!-- LOGIN -->
<div id="loginSection">
  <h1>Prisijungimas</h1>
  <input id="loginInput" placeholder="Vardas arba ORG-123">
  <button onclick="login()">Prisijungti</button>
</div>

<!-- VEIKLOS -->
<div id="activitiesSection" style="display:none;">
  <h1>SocialinÄ—s veiklos</h1>

  <!-- ORGANIZACIJAI -->
  <div id="orgPanel" style="display:none;">
    <h2>PridÄ—ti veiklÄ…</h2>
    <input id="title" placeholder="Veiklos pavadinimas">
    <input id="date" type="date">
    <input id="dateFrom" type="date" placeholder="Galioja nuo">
    <input id="dateTo" type="date" placeholder="Galioja iki">
    <input id="timeFrom" type="time">
    <input id="timeTo" type="time">
    <input id="age" type="number" min="1" placeholder="Nuo keliÅ³ metÅ³">
    <textarea id="description" placeholder="Veiklos apraÅ¡ymas"></textarea>
    <input id="locationInput" placeholder="Vietos nuoroda (Google Maps)">
    <button onclick="addActivity()">IÅ¡saugoti veiklÄ…</button>
  </div>

  <div class="activities" id="activitiesContainer"></div>
  <button class="logout" onclick="logout()">Atsijungti</button>
</div>

<!-- APIE MANE -->
<div class="about-me">
  <img src="apie-mane.jpg" alt="AÅ¡ savanoriaujant">
  <div>
    <h2>Apie mane</h2>
    <p><b>Sveiki, aÅ¡ esu Benediktas.</b></p>
    <p>Tai mano mokyklos projektas, kurÄ¯ noriu paversti realiu socialiniu projektu.</p>
  </div>
</div>

</div>

<script>
// -------- LOGIN --------
function login(){
  const val = loginInput.value.trim();
  if(!val) return alert("Ä®vesk vardÄ… arba ORG kodÄ…");

  let orgs = JSON.parse(localStorage.getItem("orgs")) || {};

  if(val.startsWith("ORG-")){
    if(!orgs[val]){
      const name = prompt("Organizacijos pavadinimas:");
      if(!name) return;
      orgs[val] = { name, activities: [] };
      localStorage.setItem("orgs", JSON.stringify(orgs));
    }
    localStorage.setItem("role","org");
    localStorage.setItem("orgCode",val);
  } else {
    localStorage.setItem("role","user");
    localStorage.setItem("user",val);
  }
  location.reload();
}

function logout(){
  localStorage.clear();
  location.reload();
}

function getOrgs(){ return JSON.parse(localStorage.getItem("orgs")) || {}; }
function saveOrgs(o){ localStorage.setItem("orgs", JSON.stringify(o)); }

// -------- VEIKLOS --------
function addActivity(editId=null){
  const orgCode = localStorage.getItem("orgCode");
  const orgs = getOrgs();
  const org = orgs[orgCode];

  const title = titleInput.value = title.value.trim();
  const dateVal = date.value;
  const dateFromVal = dateFrom.value;
  const dateToVal = dateTo.value;
  const timeF = timeFrom.value;
  const timeT = timeTo.value;
  const ageVal = age.value;
  const desc = description.value.trim();
  const loc = locationInput.value.trim();

  if(!title || !dateVal || !dateFromVal || !dateToVal || !timeF || !timeT || !ageVal || !desc){
    return alert("UÅ¾pildyk visus laukus");
  }

  if(editId){
    const a = org.activities.find(x=>x.id===editId);
    Object.assign(a,{title,date:dateVal,dateFrom:dateFromVal,dateTo:dateToVal,
      timeFrom:timeF,timeTo:timeT,age:+ageVal,description:desc,location:loc});
  } else {
    org.activities.push({
      id:Date.now(), title,date:dateVal,dateFrom:dateFromVal,dateTo:dateToVal,
      timeFrom:timeF,timeTo:timeT,age:+ageVal,description:desc,location:loc,
      registered:[]
    });
  }

  saveOrgs(orgs);
  document.querySelectorAll("#orgPanel input, #orgPanel textarea").forEach(e=>e.value="");
  renderActivities();
}

function editActivity(orgCode,id){
  const a = getOrgs()[orgCode].activities.find(x=>x.id===id);
  title.value=a.title; date.value=a.date;
  dateFrom.value=a.dateFrom; dateTo.value=a.dateTo;
  timeFrom.value=a.timeFrom; timeTo.value=a.timeTo;
  age.value=a.age; description.value=a.description;
  locationInput.value=a.location;

  const btn=document.querySelector("#orgPanel button");
  btn.textContent="IÅ¡saugoti pakeitimus";
  btn.onclick=()=>addActivity(id);
}

function deleteActivity(orgCode,id){
  if(!confirm("IÅ¡trinti veiklÄ…?")) return;
  const o=getOrgs(); o[orgCode].activities=o[orgCode].activities.filter(a=>a.id!==id);
  saveOrgs(o); renderActivities();
}

function toggleRegister(orgCode,id){
  const user=localStorage.getItem("user");
  if(!user) return alert("Prisijunk");
  const a=getOrgs()[orgCode].activities.find(x=>x.id===id);
  a.registered.includes(user) ? a.registered=a.registered.filter(u=>u!==user) : a.registered.push(user);
  saveOrgs(getOrgs()); renderActivities();
}

// -------- RENDER --------
function renderActivities(){
  const role=localStorage.getItem("role");
  activitiesContainer.innerHTML="";
  orgPanel.style.display=role==="org"?"block":"none";

  const orgs=getOrgs(), user=localStorage.getItem("user"), curOrg=localStorage.getItem("orgCode");

  Object.entries(orgs).forEach(([code,org])=>{
    org.activities.forEach(a=>{
      const reg=user && a.registered.includes(user);
      activitiesContainer.innerHTML+=`
      <div class="card">
        <h3>${a.title}</h3>
        <p><b>ğŸ¢ ${org.name}</b></p>
        <p>ğŸ“… ${a.date}</p>
        <p>ğŸ“† Galioja: ${a.dateFrom} â€“ ${a.dateTo}</p>
        <p>â° ${a.timeFrom} â€“ ${a.timeTo}</p>
        <p>ğŸ‚ Nuo ${a.age} m.</p>
        <p>ğŸ“ ${a.description}</p>
        <p>ğŸ‘¥ UÅ¾siregistravÄ™: ${a.registered.length}</p>
        ${role==="org" && code===curOrg && a.registered.length ? `<p>ğŸ“‹ Dalyviai: ${a.registered.join(", ")}</p>`:""}
        ${a.location?`<a href="${a.location}" target="_blank">ğŸ“ Vieta</a>`:""}
        ${role==="user"?`<button class="register-btn" onclick="toggleRegister('${code}',${a.id})">${reg?"âŒ Atsiregistruoti":"âœ… UÅ¾siregistruoti"}</button>`:""}
        ${role==="org" && code===curOrg?`
          <button class="edit-btn" onclick="editActivity('${code}',${a.id})">âœï¸</button>
          <button class="delete-btn" onclick="deleteActivity('${code}',${a.id})">ğŸ—‘ï¸</button>`:""}
      </div>`;
    });
  });
}

document.addEventListener("DOMContentLoaded",()=>{
  if(localStorage.getItem("role")){
    loginSection.style.display="none";
    activitiesSection.style.display="block";
    renderActivities();
  }
});
</script>
</body>
</html>
