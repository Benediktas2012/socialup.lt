<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <title>SocialUp ‚Äì socialinƒós veiklos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

  <!-- LOGIN -->
  <div id="loginSection">
    <h1>Prisijungimas</h1>
    <input id="loginInput" placeholder="Vardas arba ORG-123">
    <button onclick="login()">Prisijungti</button>
  </div>

  <!-- VEIKLOS -->
  <div id="activitiesSection" style="display:none;">
    <h1>Socialinƒós veiklos</h1>

    <!-- ORGANIZACIJAI -->
    <div id="orgPanel" style="display:none;">
      <input id="title" placeholder="Veiklos pavadinimas">
      <input id="date" type="date">
      <input id="timeFrom" type="time">
      <input id="hours" type="number" min="1" placeholder="Kiek valand≈≥ duos">
      <input id="age" type="number" min="1" placeholder="Nuo keli≈≥ met≈≥">
      <textarea id="description" placeholder="Veiklos apra≈°ymas"></textarea>
      <input id="location" placeholder="Vietos nuoroda (Google Maps)">
      <button onclick="addActivity()">I≈°saugoti veiklƒÖ</button>
    </div>

    <div class="activities" id="activitiesContainer"></div>
    <button class="logout" onclick="logout()">Atsijungti</button>
  </div>

  <!-- APIE MANE -->
  <div class="about-me">
    <img src="apie-mane.jpg" alt="A≈° savanoriaujant">
    <div>
      <h2>Apie mane</h2>
      <p><b>Sveiki, a≈° esu Benediktas.</b></p>
      <p>Tai mano mokyklos projektas, kurƒØ noriu paversti realiu socialiniu projektu.</p>
    </div>
  </div>

</div>

<script>
/* -------- LOGIN -------- */
function login(){
  const val = loginInput.value.trim();
  if(!val) return alert("ƒÆvesk vardƒÖ arba ORG kodƒÖ");

  let orgs = JSON.parse(localStorage.getItem("orgs")) || {};

  if(val.startsWith("ORG-")){
    if(!orgs[val]){
      const name = prompt("Organizacijos pavadinimas:");
      if(!name) return;
      orgs[val] = { name, activities: [] };
      localStorage.setItem("orgs", JSON.stringify(orgs));
    }
    localStorage.setItem("role","org");
    localStorage.setItem("orgCode",val);
  } else {
    localStorage.setItem("role","user");
    localStorage.setItem("user",val);
  }
  location.reload();
}

function logout(){
  localStorage.clear();
  location.reload();
}

/* -------- DUOMENYS -------- */
function getOrgs(){
  return JSON.parse(localStorage.getItem("orgs")) || {};
}
function saveOrgs(orgs){
  localStorage.setItem("orgs", JSON.stringify(orgs));
}
function getOrg(){
  return getOrgs()[localStorage.getItem("orgCode")];
}

/* -------- VEIKLOS -------- */
function addActivity(){
  const orgs = getOrgs();
  const org = orgs[localStorage.getItem("orgCode")];

  if(!title.value || !date.value || !timeFrom.value || !hours.value || !age.value || !description.value){
    return alert("U≈æpildyk visus laukus");
  }

  org.activities.push({
    id: Date.now(),
    title: title.value,
    date: date.value,
    timeFrom: timeFrom.value,
    hours: Number(hours.value),
    age: Number(age.value),
    description: description.value,
    location: location.value,
    registered: []   // <<< REGISTRACIJOS
  });

  saveOrgs(orgs);
  title.value = date.value = timeFrom.value = hours.value =
  age.value = description.value = location.value = "";
  renderOrg();
}

/* -------- REGISTRACIJA -------- */
function toggleRegister(orgCode, activityId){
  const user = localStorage.getItem("user");
  const orgs = getOrgs();
  const activity = orgs[orgCode].activities.find(a=>a.id===activityId);

  if(activity.registered.includes(user)){
    activity.registered = activity.registered.filter(u=>u!==user);
  } else {
    activity.registered.push(user);
  }

  saveOrgs(orgs);
  renderUser();
}

/* -------- RENDER -------- */
function renderOrg(){
  orgPanel.style.display="block";
  activitiesContainer.innerHTML="";
  getOrg().activities.forEach(a=>{
    activitiesContainer.innerHTML += cardHTML(a,true,getOrg().name,localStorage.getItem("orgCode"));
  });
}

function renderUser(){
  const orgs = getOrgs();
  activitiesContainer.innerHTML="";
  Object.entries(orgs).forEach(([code,org])=>{
    org.activities.forEach(a=>{
      activitiesContainer.innerHTML += cardHTML(a,false,org.name,code);
    });
  });
}

function cardHTML(a,isOrg,orgName,orgCode){
  const user = localStorage.getItem("user");
  const isRegistered = a.registered?.includes(user);

  return `
  <div class="card">
    <h3>${a.title}</h3>
    <p><b>üè¢ ${orgName}</b></p>
    <p>üìÖ ${a.date}</p>
    <p>‚è∞ Nuo ${a.timeFrom}</p>
    <p>‚è±Ô∏è ${a.hours} val.</p>
    <p>üéÇ Nuo ${a.age} m.</p>
    <p>üìù ${a.description}</p>
    <p>üë• U≈æsiregistravƒô: ${a.registered.length}</p>
    ${a.location ? `<a href="${a.location}" target="_blank">üìç Vieta</a>` : ""}
    ${!isOrg ? `
      <button onclick="toggleRegister('${orgCode}',${a.id})">
        ${isRegistered ? "‚ùå Atsiregistruoti" : "‚úÖ U≈æsiregistruoti"}
      </button>` : ""}
  </div>`;
}

/* -------- START -------- */
const role = localStorage.getItem("role");
if(role){
  loginSection.style.display="none";
  activitiesSection.style.display="block";
  role==="org" ? renderOrg() : renderUser();
}
</script>

</body>
</html>
