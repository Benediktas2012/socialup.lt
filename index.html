<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <title>SocialUp â€“ socialinÄ—s veiklos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

  <!-- LOGIN -->
  <div id="loginSection">
    <h1>Prisijungimas</h1>
    <input id="loginInput" placeholder="Vardas arba ORG-123">
    <button onclick="login()">Prisijungti</button>
  </div>

  <!-- VEIKLOS -->
  <div id="activitiesSection" style="display:none;">
    <h1>SocialinÄ—s veiklos</h1>

    <!-- ORGANIZACIJAI -->
    <div id="orgPanel" style="display:none;">
      <input id="title" placeholder="Veiklos pavadinimas">
      <input id="date" type="date">
      <input id="timeFrom" type="time">
      <input id="timeTo" type="time">
      <input id="age" type="number" placeholder="Nuo keliÅ³ metÅ³">
      <input id="location" placeholder="Vietos nuoroda (Google Maps)">
      <button onclick="addActivity()">IÅ¡saugoti veiklÄ…</button>
    </div>

    <div class="activities" id="activitiesContainer"></div>
    <button class="logout" onclick="logout()">Atsijungti</button>
  </div>

</div>

<script>
let editId = null;

/* ---------- LOGIN ---------- */
function login(){
  const val = loginInput.value.trim();
  if(!val) return alert("Ä®vesk vardÄ… arba ORG kodÄ…");

  if(val.startsWith("ORG-")){
    let orgs = JSON.parse(localStorage.getItem("orgs")) || {};

    if(!orgs[val]){
      const name = prompt("Organizacijos pavadinimas:");
      if(!name) return;
      orgs[val] = { name, activities: [] };
      localStorage.setItem("orgs", JSON.stringify(orgs));
    }

    localStorage.setItem("role","org");
    localStorage.setItem("orgCode",val);
  } else {
    localStorage.setItem("role","user");
    localStorage.setItem("user",val);
  }

  location.reload();
}

function logout(){
  localStorage.removeItem("role");
  localStorage.removeItem("orgCode");
  localStorage.removeItem("user");
  location.reload();
}

/* ---------- ORGANIZACIJOS DUOMENYS ---------- */
function getOrgs(){
  return JSON.parse(localStorage.getItem("orgs")) || {};
}

function saveOrgs(orgs){
  localStorage.setItem("orgs", JSON.stringify(orgs));
}

function getOrg(){
  const orgs = getOrgs();
  return orgs[localStorage.getItem("orgCode")];
}

/* ---------- VEIKLOS ---------- */
function addActivity(){
  const orgs = getOrgs();
  const code = localStorage.getItem("orgCode");
  const org = orgs[code];

  if(!title.value || !date.value || !timeFrom.value || !timeTo.value){
    return alert("UÅ¾pildyk visus laukus");
  }

  if(editId){
    const a = org.activities.find(a=>a.id===editId);
    Object.assign(a,{
      title: title.value,
      date: date.value,
      timeFrom: timeFrom.value,
      timeTo: timeTo.value,
      age: age.value,
      location: location.value
    });
    editId = null;
  } else {
    org.activities.push({
      id: Date.now(),
      title: title.value,
      date: date.value,
      timeFrom: timeFrom.value,
      timeTo: timeTo.value,
      age: age.value,
      location: location.value
    });
  }

  saveOrgs(orgs);
  clearForm();
  renderOrg();
}

function clearForm(){
  title.value = date.value = timeFrom.value =
  timeTo.value = age.value = location.value = "";
}

function editActivity(id){
  const a = getOrg().activities.find(a=>a.id===id);
  title.value = a.title;
  date.value = a.date;
  timeFrom.value = a.timeFrom;
  timeTo.value = a.timeTo;
  age.value = a.age;
  location.value = a.location;
  editId = id;
}

function deleteActivity(id){
  const orgs = getOrgs();
  const org = orgs[localStorage.getItem("orgCode")];
  org.activities = org.activities.filter(a=>a.id!==id);
  saveOrgs(orgs);
  renderOrg();
}

/* ---------- RENDER ---------- */
function renderOrg(){
  orgPanel.style.display="block";
  activitiesContainer.innerHTML="";
  getOrg().activities.forEach(a=>{
    activitiesContainer.innerHTML += cardHTML(a,true);
  });
}

function renderUser(){
  const orgs = getOrgs();
  activitiesContainer.innerHTML="";
  Object.values(orgs).forEach(org=>{
    org.activities.forEach(a=>{
      activitiesContainer.innerHTML += cardHTML(a,false,org.name);
    });
  });
}

function cardHTML(a,isOrg,orgName=""){
  return `
  <div class="card">
    <h3>${a.title}</h3>
    ${orgName ? `<p><b>${orgName}</b></p>` : ""}
    <p>ğŸ“… ${a.date}</p>
    <p>â° ${a.timeFrom} â€“ ${a.timeTo}</p>
    <p>ğŸ‚ Nuo ${a.age || "?"} m.</p>
    ${a.location ? `<a href="${a.location}" target="_blank">ğŸ“ Vieta</a>` : ""}
    ${isOrg ? `
      <button onclick="editActivity(${a.id})">âœï¸</button>
      <button onclick="deleteActivity(${a.id})">ğŸ—‘ï¸</button>
    ` : ""}
  </div>`;
}

/* ---------- START ---------- */
const role = localStorage.getItem("role");
if(role){
  loginSection.style.display="none";
  activitiesSection.style.display="block";
  role==="org" ? renderOrg() : renderUser();
}
</script>

</body>
</html>
