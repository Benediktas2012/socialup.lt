<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <title>SocialUp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

  <!-- LOGIN -->
  <div id="loginSection">
    <h1>Prisijungimas</h1>
    <input id="orgName" placeholder="Organizacijos pavadinimas (tik org)">
    <input id="loginInput" placeholder="Vardas arba ORG-123">
    <button onclick="login()">Prisijungti</button>
  </div>

  <!-- ORGANIZACIJA -->
  <div id="orgSection" style="display:none;">
    <h1 id="orgTitle"></h1>

    <div class="card">
      <input id="title" placeholder="Veiklos pavadinimas">
      <input id="date" type="date">
      <input id="hours" type="number" placeholder="Valandos">
      <button onclick="saveActivity()">IÅ¡saugoti veiklÄ…</button>
    </div>

    <div id="orgActivities" class="activities"></div>
    <button class="logout" onclick="logout()">Atsijungti</button>
  </div>

  <!-- ASMUO -->
  <div id="userSection" style="display:none;">
    <h1>Galimos veiklos</h1>
    <div id="userActivities" class="activities"></div>
    <button class="logout" onclick="logout()">Atsijungti</button>
  </div>

  <!-- APIE MANE -->
  <div class="about-me">
    <h2>Apie mane</h2>
    <p><b>Sveiki, aÅ¡ esu Benediktas.</b></p>
    <p>
      Tai yra mano mokyklos projektas, taÄiau noriu jÄ¯ praplÄ—sti Ä¯
      socialinÄ¯ projektÄ…. Å io puslapio tikslas â€“ padÄ—ti Å¾monÄ—ms
      lengviau rasti socialines veiklas ir savanorystÄ—s galimybes.
    </p>
    <p>
      Å iuo metu ieÅ¡kau partneriÅ³ ir organizacijÅ³, kurios norÄ—tÅ³
      prisidÄ—ti prie Å¡ios idÄ—jos vystymo.
    </p>
  </div>

</div>

<script>
let editId = null;

function login(){
  const code = loginInput.value.trim();
  const name = orgName.value.trim();

  if(!code) return alert("Ä®vesk duomenis");

  if(code.startsWith("ORG-")){
    const key = "org_" + code;
    const saved = JSON.parse(localStorage.getItem(key));

    if(saved && saved.name !== name){
      return alert("Neteisingas organizacijos pavadinimas");
    }

    if(!saved){
      localStorage.setItem(key, JSON.stringify({
        name,
        activities:[]
      }));
    }

    localStorage.setItem("role","org");
    localStorage.setItem("orgCode",code);
  } else {
    localStorage.setItem("role","user");
    localStorage.setItem("user",code);
  }
  location.reload();
}

function logout(){
  localStorage.clear();
  location.reload();
}

function getOrg(){
  return JSON.parse(
    localStorage.getItem("org_" + localStorage.getItem("orgCode"))
  );
}

function saveOrg(org){
  localStorage.setItem(
    "org_" + localStorage.getItem("orgCode"),
    JSON.stringify(org)
  );
}

function saveActivity(){
  const org = getOrg();

  if(editId){
    const a = org.activities.find(a=>a.id===editId);
    a.title = title.value;
    a.date = date.value;
    a.hours = hours.value;
    editId = null;
  } else {
    org.activities.push({
      id: Date.now(),
      title: title.value,
      date: date.value,
      hours: hours.value,
      regs:[]
    });
  }

  saveOrg(org);
  title.value = date.value = hours.value = "";
  renderOrg();
}

function editActivity(id){
  const a = getOrg().activities.find(a=>a.id===id);
  title.value = a.title;
  date.value = a.date;
  hours.value = a.hours;
  editId = id;
}

function deleteActivity(id){
  const org = getOrg();
  org.activities = org.activities.filter(a=>a.id!==id);
  saveOrg(org);
  renderOrg();
}

function renderOrg(){
  const org = getOrg();
  orgTitle.innerText = org.name;
  orgActivities.innerHTML = "";

  org.activities.forEach(a=>{
    orgActivities.innerHTML += `
      <div class="card">
        <h3>${a.title}</h3>
        <p>ğŸ“… ${a.date}</p>
        <p>â±ï¸ ${a.hours} val.</p>
        <p>ğŸ‘¥ UÅ¾siregistravo: ${a.regs.length}</p>
        <button onclick="editActivity(${a.id})">âœï¸ Redaguoti</button>
        <button onclick="deleteActivity(${a.id})">ğŸ—‘ï¸ IÅ¡trinti</button>
      </div>
    `;
  });
}

function renderUser(){
  userActivities.innerHTML = "";
  Object.keys(localStorage).forEach(k=>{
    if(k.startsWith("org_")){
      const org = JSON.parse(localStorage.getItem(k));
      org.activities.forEach(a=>{
        userActivities.innerHTML += `
          <div class="card">
            <h3>${a.title}</h3>
            <p>ğŸ“… ${a.date}</p>
            <p>â±ï¸ ${a.hours} val.</p>
            <p>ğŸ‘¥ ${a.regs.length} Å¾moniÅ³</p>
          </div>
        `;
      });
    }
  });
}

if(localStorage.getItem("role")==="org"){
  loginSection.style.display="none";
  orgSection.style.display="block";
  renderOrg();
}

if(localStorage.getItem("role")==="user"){
  loginSection.style.display="none";
  userSection.style.display="block";
  renderUser();
}
</script>

</body>
</html>
